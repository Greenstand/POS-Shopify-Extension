# Auth workflow

There are currently two workflows for the API:

1. Shopify App workflow
2. Shopify App Extension workflow

## Shopify App workflow

The Shopify App workflow is for requests coming from the Shopify App, that is embedded in the Shopify Dashboard.

- Already authenticated by Shopify
- Shopify has a 7-step workflow that then comes to our API
- The node.js template includes auth for this

## Shopify App Extension workflow

The Shopify App Extension workflow is for requests coming from the post-purchase extension on the client side, where the users shop.

- Is not automatically implemented
- Need to manually check the JWT issued by Shopify

### How it works

- https://shopify.dev/docs/apps/selling-strategies/purchase-options/app-extensions/authenticate
- https://shopify.dev/docs/apps/selling-strategies/purchase-options/app-extensions/authenticate#manually-validate-a-session-token

_From the Shopify Docs_

To verify that a session token is coming from Shopify, you can encode a new session token using your app’s shared secret and compare it to the encoded token received from your extension.

An encoded JWT is a string with the following structure:

    {header}.{payload}.{signature}

> **Note**
>
> - {header}, {payload}, and {signature} are all Base64-encoded.
> - {signature} verifies that the header and payload were encoded using the shared secret and confirms that the token was generated by Shopify.
> - For more information about the structure, refer to Anatomy of a session token and JWT.io.

1. Using the SHA-256 algorithm, hash the decoded {header} and {payload} values from the extension session token.

2. Sign the string using JWT. Specify the HS256 algorithm and use the app’s secret as the signing key.

3. Base64url-encode the result.

4. Compare the new session token with the session token received from your extension.

If the session tokens are identical, then the request came from Shopify.
